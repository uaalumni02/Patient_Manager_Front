<!DOCTYPE html>
<html>

<head>
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" media="screen" href="css/newLogin.css" />
    <link rel="stylesheet" type="text/css" href="css/util.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <link href="css/search.css" rel='stylesheet' type='text/css' />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
</head>

<body>
    
    <div id="fullscreen_bg" class="fullscreen_bg">

        <div class="container">

            <form id="LoginForm" action="" method="POST" class="form-signin">
                <h1 class="form-signin-heading text-muted">Patient Manager</h1>
                <input type="text" class="form-control" id="username" placeholder="Username" required="">
                <input type="password" class="form-control" id="password" placeholder="Password" required="">
                <button class="btn btn-lg btn-primary btn-block" type="submit">
                    Sign In
                </button>
                <a href="http://localhost:8080/register">Click link to register</a>
            </form>

        </div>
        <div  id="searchFormContainer" class="container-contact100">
            <div class="wrap-contact100">
                <form id="searchForm" class="contact100-form validate-form" action="" method="POST">
                    <span class="contact100-form-title">
                        Patient Information
                    </span>
    
                    <div class="wrap-input100  bg1">
                        <span class="label-input100">Search for Patients *</span>
                        <input class="input100" id="search" type="text" name="name" placeholder="Enter Patient Name">
                    </div>
    
                    <div class="container-contact100-form-btn">
                        <button class="contact100-form-btn" type="submit">
                            <span>
                                Submit
                                <i class="fa fa-long-arrow-right m-l-7" aria-hidden="true" ></i>
                            </span>
                        </button>
                    </div>
                </form>
    
            </div>
    
            <table id="table" style="width:100%">
    
            </table>
        </div>
    
</body>
<script>


    document.addEventListener("DOMContentLoaded", () => {
        const theForm = document.getElementById("LoginForm");

        theForm.addEventListener("submit", (event) => {
            let username = document.getElementById("username").value;
            let password = document.getElementById("password").value;
            event.preventDefault();
            fetch('http://localhost:3000/api/user/login', {
                method: "post",
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    username: username,
                    password: password
                })
            })

                .then(res => res.json())
                .then(response => {
                    localStorage.setItem('token', response.token);
                    const password = response.token
                    const localStoragePswd = localStorage.getItem('token', response.token);
                    if(password === localStoragePswd) {
                        document.getElementById('searchFormContainer').style.display = "block";
                        document.getElementById('LoginForm').style.display = "none";
                    } else {
                        alert('Incorrect Password')
                    }
                }).catch(error => console.error('Error:', error));
                $('#LoginForm').get(0).reset();
        })
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const theForm = document.getElementById("searchForm");

        theForm.addEventListener("submit", (event) => {
            event.preventDefault();
            let name = document.getElementById("search").value;
            const token = localStorage.getItem('token');
            const bearer = 'Bearer ' + token
            fetch('http://localhost:3000/api/patient/' + name, {
                method: "GET",
                headers: {
                    'Authorization': bearer,
                }
            })
                .then(res => res.json())
                .then(response => {

                    let html = '';
                    html += `<td>  Name: ${response.name} </td>`;
                    html += `<td>  Email: ${response.email}  </td>`;
                    html += `<td>  Phone: ${response.phone} </td>`;
                    html += `<td>  Address: ${response.address} </td>`;
                    html += `<td>  Medication: ${response.medication} </td>`;
                    html += `<td>  Diagnosis: ${response.diagnosis}  </td>`;
                    html += `<td>  AdditionalInfo: ${response.additionalInfo} </td>`;

                    const personContainer = document.getElementById("table");

                    personContainer.innerHTML = html;

                })
                .catch(error => console.error('Error:', error));
                $('#searchForm').get(0).reset();

        })

    })

</script>

</html>